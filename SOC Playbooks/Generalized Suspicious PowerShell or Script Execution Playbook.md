# Generalized Suspicious PowerShell or Script Execution Playbook

---

**Project Title:** Generalized Suspicious PowerShell or Script Execution Playbook

**Alert Type:** Detection of potentially malicious or abnormal PowerShell or script execution activity

**Version:** 1.0

**Date:** 2025-12-09

**Incident Type/Categorization:** Execution / Potential Malware / Living-off-the-Land

**Severity/Priority by Default:** High (tune per environment)

**Source Platform:** SIEM Platform

---

### **Why does it matter? (business impact)**

PowerShell and scripting engines (e.g., cmd, wscript, cscript, bash, Python) are commonly abused by attackers to deliver malware, execute payloads, establish persistence, evade defenses, and perform lateral movement. Malicious script execution can lead to system compromise, credential theft, data exfiltration, ransomware deployment, and significant business disruption. Early detection reduces dwell time and limits attacker impact.

---

## **Triage (Tier 1)**

### **Review Process and Command Line**

- Identify process name (`powershell.exe`, `pwsh.exe`, `cmd.exe`, `wscript.exe`, `cscript.exe`, `python.exe`, `bash`).
- Review full command line arguments.
- Look for suspicious flags such as:
    - `enc`, `encodedCommand`
    - `nop`, `noprofile`
    - `w hidden`
    - `IEX`, `Invoke-WebRequest`, `DownloadString`
- Identify whether script execution appears obfuscated or encoded.

### **Review User and Host Context**

- Identify the executing user (`UserName`, `SubjectUserName`).
- Determine whether the user is an admin, service account, or standard user.
- Identify the executing host (`host.name`, `agent.computer_name`).
- Confirm whether the host is a workstation, server, or admin system.

### **Review Parent Process**

- Identify the parent process that spawned the script (email client, browser, Office app, installer, scheduled task).
- Flag suspicious parent-child relationships (e.g., `winword.exe` â†’ `powershell.exe`).

### **Review Timestamp and Frequency**

- Review time of execution and repetition.
- Identify whether scripts executed repeatedly or across multiple systems.
- Consider off-hours or abnormal execution timing.

### **Check for Related Alerts**

- Phishing or malicious email alerts
- Malware or EDR detections
- C2 or bad reputation network activity
- Credential access or privilege escalation alerts
- Persistence-related alerts

### **Escalate when:**

- The command is obfuscated, encoded, or downloads external content.
- Execution originates from user context where scripting is unusual.
- The script is spawned by a suspicious parent process (Office, browser, temp directory).
- Multiple systems show similar activity.
- Network activity to suspicious external IPs or domains is observed.

**Escalation targets:** SOC Tier 2 / Senior SOC Analyst / Lead SOC Analyst / IR Investigator

---

## **Investigation (Tier 2 / Senior SOC / IR)**

### **Analyze Script Content and Behavior**

- Decode any encoded or obfuscated commands.
- Identify script purpose (download, execution, persistence, reconnaissance).
- Search for known malware signatures or TTPs.

### **Investigate Host Activity**

- Review EDR telemetry for:
    - File creation or deletion
    - Registry modifications
    - Scheduled task or service creation
    - Process injection or suspicious child processes
- Identify if the script established persistence or altered security controls.

### **Review Network Activity**

- Check for outbound connections generated by the process.
- Identify C2, malware hosting, or suspicious domains/IPs.
- Review proxy, firewall, and DNS logs.

### **User and Role Validation**

- Confirm with the user or system owner whether script execution was legitimate.
- Identify whether automation, IT tooling, or administrative tasks were expected.

### **Historical Analysis**

- Review past execution activity on the same host and user.
- Determine whether similar commands have executed previously.
- Identify whether this behavior is new or recurring.

### **Escalate when:**

- The script performs malicious actions (download, privilege escalation, credential access).
- Persistence mechanisms are observed.
- Network traffic confirms C2 or malware delivery.
- Multiple hosts exhibit similar execution patterns.
- The user denies having executed the script.

**Escalation targets:** IR Lead, SOC Manager, business owner

---

## **Containment / Remediation**

- Isolate the affected host if malicious execution is confirmed or strongly suspected.
- Terminate malicious processes.
- Remove malicious scripts or associated files.
- Reset credentials for affected users if credential theft is suspected.
- Block malicious domains and IPs at security controls.
- Disable malicious scheduled tasks, services, or registry autoruns.
- Patch vulnerable software abused for execution.
- Notify IR Lead, IT operations, and system owner.

---

## **Recovery & Lessons Learned**

- Verify systems are clean and no persistence mechanisms remain.
- Restore affected systems from known-good backups if required.
- Update PowerShell and script logging policies (Script Block, Module, Transcription).
- Tune detection rules based on attack patterns observed.
- Add identified indicators to blocklists and threat intelligence feeds.
- Perform root cause analysis:
    - How was the script delivered?
    - What execution controls failed or were missing?
- Document the incident, response actions, and long-term hardening recommendations.
